// Intel DRAM specific mapping
#include <linux/cpufeature.h>
#include <linux/kernel.h>

#include "dram_mapping.h"
#include "linux/export.h"

static const size_t cometlake_dram_matrix[] = {
        0b000000000000000010000001000000,
        0b000000000000100100000000000000,
        0b000000000001001000000000000000,
        0b000000000010010000000000000000,
        0b000000000000000001000000000000,
        0b000000000000000000100000000000,
        0b000000000000000000010000000000,
        0b000000000000000000001000000000,
        0b000000000000000000000100000000,
        0b000000000000000000000010000000,
        0b000000000000000000000001000000,
        0b000000000000000000000000100000,
        0b000000000000000000000000010000,
        0b000000000000000000000000001000,
        0b000000000000000000000000000100,
        0b000000000000000000000000000010,
        0b000000000000000000000000000001,
        0b100000000000000000000000000000,
        0b010000000000000000000000000000,
        0b001000000000000000000000000000,
        0b000100000000000000000000000000,
        0b000010000000000000000000000000,
        0b000001000000000000000000000000,
        0b000000100000000000000000000000,
        0b000000010000000000000000000000,
        0b000000001000000000000000000000,
        0b000000000100000000000000000000,
        0b000000000010000000000000000000,
        0b000000000001000000000000000000,
        0b000000000000100000000000000000
};

static const size_t cometlake_addr_matrix[] = {
        0b000000000000000001000000000000,
        0b000000000000000000100000000000,
        0b000000000000000000010000000000,
        0b000000000000000000001000000000,
        0b000000000000000000000100000000,
        0b000000000000000000000010000000,
        0b000000000000000000000001000000,
        0b000000000000000000000000100000,
        0b000000000000000000000000010000,
        0b000000000000000000000000001000,
        0b000000000000000000000000000100,
        0b000000000000000000000000000010,
        0b000000000000000000000000000001,
        0b000100000000000000000000000100,
        0b001000000000000000000000000010,
        0b010000000000000000000000000001,
        0b100000000010000000000000000000,
        0b000010000000000000000000000000,
        0b000001000000000000000000000000,
        0b000000100000000000000000000000,
        0b000000010000000000000000000000,
        0b000000001000000000000000000000,
        0b000000000100000000000000000000,
        0b000000000010000000000000000000,
        0b000000000001000000000000000000,
        0b000000000000100000000000000000,
        0b000000000000010000000000000000,
        0b000000000000001000000000000000,
        0b000000000000000100000000000000,
        0b000000000000000010000000000000
};

struct dram_config intel_cometlake_config = {
    .name = "Intel Comet Lake",
    .dram_matrix = cometlake_dram_matrix,
    .addr_matrix = cometlake_addr_matrix,

    .phys_dram_offset = 0,

    // 4 bank bits (consisting of rank, bank group, bank)
    .bank_mask = 0b1111,  // 3 bits for bank
    .bank_shift = 26,   // bits [5:3]

    // 13 row bits (inside 1 GB)
    .row_shift = 0,    
    .row_mask = 0b1111111111111, 

    // 13 column bits
    .column_mask = 0b1111111111111,  
    .column_shift = 13,    

    // 30 bits (1 GB)
    .matrix_size = 30,
};

EXPORT_SYMBOL(intel_cometlake_config);
